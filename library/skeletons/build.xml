<?xml version="1.0" encoding="utf-8"?>

<project name="CommonSearch" default="test">
	<property name="main" location="${basedir}" />
	<property name="main.src" location="${main}/src" />
	<property name="main.bin" location="${main}/target" />
	<property name="dist" location="${basedir}/dist" />
	<property name="lib" location="${basedir}/lib" />

	<!-- Sets the classname -->
	<property name="classname" value="unknown"/>
	<property name="mainclass" value="${classname}.MainClass"/>
	<property name="jarfile" value="jar-file"/>

	<!-- Sets the classpath -->
	<path id="main.compile.classpath">
		<pathelement location="${main.bin}" />
		<pathelement location="${tests}" />
	</path>

	<!-- Sets the classpath for the tests -->
	<path id = "classpath.test">
		<pathelement location = "lib/junit-4.13.2.jar" />
		<pathelement location = "lib/hamcrest-core-1.3.jar" />
		<pathelement location = "${tests}" />
		<pathelement location = "${main.src}" />
		<path refid = "main.compile.classpath" />
	</path>

	<!-- Removes unnecessary parts -->
	<target name="clean" description="Remove output directories">
		<delete dir="${main.bin}" />
		<delete dir="${dist}" />
	</target>

	<!-- Initialises everything -->
	<target name="init" description="Create output directories">
		<mkdir dir="${main.bin}" />
		<mkdir dir="${dist}" />
	</target>

	<!-- Actually runs the program (not jar) -->
	<target name="run" description="Create output directories" depends="compile">
		<java classname="${mainclass}" fork="true">
			<classpath refid="main.compile.classpath"/>
		</java>
	</target>

	<!-- Compiles to .class-files (not jar) -->
	<target name="compile" depends="init" description="Compile main project">
		<javac
		srcdir="${main.src}"
		destdir="${main.bin}"
		includeantruntime="true">
		<classpath refid="main.compile.classpath" />
		</javac>
	</target>

	<!-- Compiles the jar-file -->
	<target name="jar" depends="compile" description="Compile to jar">
		<jar destfile="${dist}/${jarfile}.jar" basedir="${main.bin}">
			<manifest>
				<attribute name="Main-Class" value="${mainclass}"/>
			</manifest>
		</jar>
	</target>

	<target name="test" depends="compile" description="Run test">
		<junit printsummary="no" haltonerror="yes" haltonfailure="yes" fork="no">
			<formatter type="brief" usefile="false" />
			<classpath refid = "classpath.test" />
			<test name="se.miun.dt015a.guesser.Test" />
		</junit>
	</target>
</project>
